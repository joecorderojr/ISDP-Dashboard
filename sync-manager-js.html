<script>
  $("#btnSyncCyber2026").click(function () {
    onCyberClick("2026");
  });

  $("#btnSyncCyber2025").click(function () {
    onCyberClick("2025");
  });

  $("#btnSyncCyber2024").click(function () {
    onCyberClick("2024");
  });

  $("#btnDataPrivacy2026").click(function () {
    onDataPrivacyClick("2026");
  });

  $("#btnDataPrivacy2025").click(function () {
    onDataPrivacyClick("2025");
  });

  $("#btnDataPrivacy2024").click(function () {
    onDataPrivacyClick("2024");
  });

  function onCyberClick(year){
    $("#lblSyncCyber" + year).html("synching...");
    $("#lblSyncCyber" + year).removeClass();

    google.script.run
      .withSuccessHandler(function (data) {
        // 'data' is the JSON object returned by updateCyberSecurity2024()
        if (data && data === "Success") {
          $("#lblSyncCyber" + year).html("synced");
          $("#lblSyncCyber" + year).addClass("text-success");
        } else {
          $("#lblSyncCyber" + year).html("error");
          $("#lblSyncCyber" + year).addClass("text-danger");
        }
      })
      .withFailureHandler(function (error) {
        $("#lblSyncCyber" + year).html("error: " + error.message);
        $("#lblSyncCyber" + year).addClass("text-danger");
      })
      .updateCyberSecurity(year); // The function name in code.gs
  };

  

  function onDataPrivacyClick(year)
  {
    $("#lblSyncDataPrivacy" + year).html("synching...");
    $("#lblSyncDataPrivacy" + year).removeClass();

    google.script.run
      .withSuccessHandler(function (data) {
        // 'data' is the JSON object returned by updateDataPrivacyTrainingData()
        if (data && data === "Success") {
          $("#lblSyncDataPrivacy" + year).html("synced");
          $("#lblSyncDataPrivacy" + year).addClass("text-success");
        } else {
          $("#lblSyncDataPrivacy" + year).html("error: " + data);
          $("#lblSyncDataPrivacy" + year).addClass("text-danger");
        }
      })
      .withFailureHandler(function (error) {
        $("#lblSyncDataPrivacy" + year).html("error: " + error.message);
        $("#lblSyncDataPrivacy" + year).addClass("text-danger");
      })
      .updateDataPrivacyTrainingData(year); // The function name in Code-sync.gs
  }

  function upload() {
    $("#upload-error").hide();
    $("#upload-name-error").hide();

    const file = $("#fileInputVASummary")[0].files[0];
    const fileName = $("#fileNameVASummary").val();

    if (!file || !fileName) {
      if (!file) $("#upload-error").show();
      if (!fileName) $("#upload-name-error").show();
      return;
    }

    const reader = new FileReader();
    console.log("fileName: ", fileName);

    reader.onload = (e) => {
      const base64Data = e.target.result.split(",")[1];

      $("#upload-btn").prop("disabled", true);
      $("#upload-status").html("⏳ Uploading...");

      google.script.run
        .withSuccessHandler(showResult)
        .withFailureHandler(showError)
        .uploadAndSummarize(
          base64Data,
          fileName,
          "1tcM-9MsOuIm1bRXdDXCv3Av54a5Lmbh8"
        );
    };

    reader.readAsDataURL(file);
  }

  function showResult(response) {
    console.log("success response: ", response);
    $("#upload-status").html(
      `✅ Uploaded: <a href="${response.fileUrl}" target="_blank">${response.name}</a>`
    );
    $("#fileInputVASummary").val("");
    $("#fileNameVASummary").val("");
    $("#upload-btn").prop("disabled", false);
  }

  function showError(err) {
    $("#upload-status").html(`❌ Upload failed: ${err.message}`);
    $("#upload-btn").prop("disabled", false);
  }
</script>
